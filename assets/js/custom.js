async function saveLead(e,t,l,n,i,o){if("+91"===l){let a=n.replace(/\D/g,"");if(10!==a.length||/^[1-5]/.test(a))return alert("Invalid phone number. For Indian numbers, enter a valid 10-digit number starting with 6-9."),!1}let u=document.querySelector(".dropnOtp");if(u&&""===u.value&&parseInt(n))try{let r=await fetch("https://api.homesfy.in/api/users/send_otp",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phone:parseInt(n)})});if(r.ok){let d=await r.json();u.value=d.otp}}catch(m){console.error("Error sending OTP:",m)}let s=[".FillOtp",".FillOtp1",".FillOtp2"].map(e=>document.querySelector(e)).filter(e=>e);if(!u||""!==u.value&&s.some(e=>u.value===e.value)){let p=queryForm(),c=await getIpAddress(),g=deviceData(),f=browserData(),y={name:e,email:t,country_code:l,number:n,tracking_lead_id:i,nationality:1,source_id:31,project_id:projectId,Digital:{user_device:g,user_browser:f,campaing_type:p?p.utmcampaign:null,launch_name:"",client_ipaddress:c,client_pref:o}};p&&(y.Utm={utm_medium:p.utmmedium,utm_source:p.utmsource,utm_content:p.utmcontent,utm_term:p.utmterm}),1===is_magnet&&(y.is_magnet=is_magnet,y.magnet_id=magnet_id,y.source_id=49),localStorage.setItem("submittedCountryCode", l);
        localStorage.setItem("submittedPhone", n);

        // ✅ Only phone number pushed to GTM
        window.dataLayer = window.dataLayer || [];
        window.dataLayer.push({
            event: 'formSubmitted',
            phone_number: `${l}${n}`,
        });
SendLead(y,"thankyou.html")}else if(u&&""!==u.value)return alert("Invalid OTP"),!1}function setupToggleButton(e,t,l){let n=document.getElementById(e);n&&n.addEventListener("click",function(){toggleVisibility(t,"block"),toggleVisibility(l,"none")})}function toggleVisibility(e,t){document.querySelectorAll(`.${e}`).forEach(e=>{e.style.display=t})}document.addEventListener("DOMContentLoaded",function(){apiDataGet(projectId),["ModalFormSlug1","ModalFormSlug2","ModalFormSlug3","ModalFormSlug4"].forEach(e=>{let t=document.getElementById(e);t&&t.addEventListener("submit",function(e){e.preventDefault();let l=t.querySelector(".form-name").value,n=t.querySelector(".form-country").value,i=t.querySelector(".form-number").value,o=t.dataset.trackingId||"default_tracking_id";saveLead(l,null,n,i,o)})}),setupToggleButton("dropbtn","showdrop","hidedrop"),setupToggleButton("mbutton","mfieldshow","mfieldhide"),setupToggleButton("popbutton","popfieldshow","popfieldhide")});